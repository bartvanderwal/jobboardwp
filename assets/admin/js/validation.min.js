!function(r,o){var s=wp.data.dispatch("core/editor"),e=wp.data.select("core/editor"),c=wp.data.dispatch("core/notices"),d=!1;console.log(s),console.log(wp.data.select("core/editor"));var l,t,i,a,b=s.savePost,p=!1,n="";wp.data.subscribe(function(){var o=e.getEditedPostAttribute("status");p="publish"===o||"future"===o,n="publish"!==o?o:n}),s.savePost=function(n){n=n||{};var o=this,e=arguments;return new Promise(function(e,o){if(l=e,!d&&(n.isAutosave||n.isPreview))return e("Validation ignored (autosave).");if(!p)return e("Validation ignored (draft).");var t=r("form.metabox-location-normal").serializeArray(),i={};r(t).each(function(o,e){var t=e.name.substring(e.name.lastIndexOf("[")+1,e.name.lastIndexOf("]"));i[t]=e.value});var a=wp.data.select("core/editor").getEditedPostContent();wp.ajax.send("jb-validate-job-data",{data:{description:a,data:i,nonce:jb_admin_data.nonce},success:function(o){r(".jb-forms-line .jb-forms-field").css("border","#8c8f94 solid 1px"),r(".jb-forms-line .jb-forms-field").parent().find("p.description").css("color","#2c3338"),d=o.valid?(c.removeNotice("jbwp-validation"),e("Validation bypassed."),s.unlockPostSaving("jbwp"),c.removeNotice("jbwp-validation"),!1):(o.empty&&o.empty.forEach(function(o,e,t){r("#jb-job-meta_"+o).css("border","#d63638 solid 1px")}),o.wrong&&o.wrong.forEach(function(o,e,t){r("#jb-job-meta_"+o).css("border","#d63638 solid 1px"),r("#jb-job-meta_"+o).parent().find("p.description").css("color","#d63638")}),s.lockPostSaving("jbwp"),c.createErrorNotice(o.notice,{id:"jbwp-validation",isDismissible:!0}),!0)},error:function(o){console.log(o),s.unlockPostSaving("jbwp"),d=!1}})}).then(function(){return b.apply(o,e)}).catch(function(o){})},r(document.body).on("keyup",".jb-forms-line .jb-forms-field",(t=function(){if(d){var o=r("form.metabox-location-normal").serializeArray(),i={};r(o).each(function(o,e){var t=e.name.substring(e.name.lastIndexOf("[")+1,e.name.lastIndexOf("]"));i[t]=e.value});var e=wp.data.select("core/editor").getEditedPostContent();wp.ajax.send("jb-validate-job-data",{data:{description:e,data:i,nonce:jb_admin_data.nonce},success:function(o){r(".jb-forms-line .jb-forms-field").css("border","#8c8f94 solid 1px"),r(".jb-forms-line .jb-forms-field").parent().find("p.description").css("color","#2c3338"),o.valid?(c.removeNotice("jbwp-validation"),s.unlockPostSaving("jbwp"),c.removeNotice("jbwp-validation"),d=!1,l("Validation bypassed.")):(o.empty&&o.empty.forEach(function(o,e,t){r("#jb-job-meta_"+o).css("border","#d63638 solid 1px")}),o.wrong&&o.wrong.forEach(function(o,e,t){r("#jb-job-meta_"+o).css("border","#d63638 solid 1px"),r("#jb-job-meta_"+o).parent().find("p.description").css("color","#d63638")}),s.lockPostSaving("jbwp"),c.createErrorNotice(o.notice,{id:"jbwp-validation",isDismissible:!0}),d=!0)},error:function(o){console.log(o),s.unlockPostSaving("jbwp"),d=!1}})}},i=1e3,a=0,function(){var o=this,e=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(o,e)},i||0)}))}(jQuery);