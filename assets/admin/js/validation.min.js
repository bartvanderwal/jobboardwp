!function(n){var r=wp.data.dispatch("core/editor"),e=wp.data.select("core/editor"),s=wp.data.dispatch("core/notices"),c=!1;console.log(r),console.log(wp.data.select("core/editor"));var d,t,i,a,l=r.savePost,b=!1;wp.data.subscribe(function(){var o=e.getEditedPostAttribute("status");b="publish"===o||"future"===o,0}),r.savePost=function(a){a=a||{};var o=this,e=arguments;return new Promise(function(e,o){if(d=e,!c&&(a.isAutosave||a.isPreview))return e("Validation ignored (autosave).");if(!b)return e("Validation ignored (draft).");var t=n("form.metabox-location-normal").serializeArray(),i={};n(t).each(function(o,e){var t=e.name.substring(e.name.lastIndexOf("[")+1,e.name.lastIndexOf("]"));i[t]=e.value});t=wp.data.select("core/editor").getEditedPostContent();wp.ajax.send("jb-validate-job-data",{data:{description:t,data:i,nonce:jb_admin_data.nonce},success:function(o){n(".jb-forms-line .jb-forms-field").css("border","#8c8f94 solid 1px"),n(".jb-forms-line .jb-forms-field").parent().find("p.description").css("color","#2c3338"),c=o.valid?(s.removeNotice("jbwp-validation"),e("Validation bypassed."),r.unlockPostSaving("jbwp"),s.removeNotice("jbwp-validation"),!1):(o.empty&&o.empty.forEach(function(o,e,t){n("#jb-job-meta_"+o).css("border","#d63638 solid 1px")}),o.wrong&&o.wrong.forEach(function(o,e,t){n("#jb-job-meta_"+o).css("border","#d63638 solid 1px"),n("#jb-job-meta_"+o).parent().find("p.description").css("color","#d63638")}),r.lockPostSaving("jbwp"),s.createErrorNotice(o.notice,{id:"jbwp-validation",isDismissible:!0}),!0)},error:function(o){console.log(o),r.unlockPostSaving("jbwp"),c=!1}})}).then(function(){return l.apply(o,e)}).catch(function(o){})},n(document.body).on("keyup",".jb-forms-line .jb-forms-field",(t=function(){var i,o;c&&(o=n("form.metabox-location-normal").serializeArray(),i={},n(o).each(function(o,e){var t=e.name.substring(e.name.lastIndexOf("[")+1,e.name.lastIndexOf("]"));i[t]=e.value}),o=wp.data.select("core/editor").getEditedPostContent(),wp.ajax.send("jb-validate-job-data",{data:{description:o,data:i,nonce:jb_admin_data.nonce},success:function(o){n(".jb-forms-line .jb-forms-field").css("border","#8c8f94 solid 1px"),n(".jb-forms-line .jb-forms-field").parent().find("p.description").css("color","#2c3338"),o.valid?(s.removeNotice("jbwp-validation"),r.unlockPostSaving("jbwp"),s.removeNotice("jbwp-validation"),c=!1,d("Validation bypassed.")):(o.empty&&o.empty.forEach(function(o,e,t){n("#jb-job-meta_"+o).css("border","#d63638 solid 1px")}),o.wrong&&o.wrong.forEach(function(o,e,t){n("#jb-job-meta_"+o).css("border","#d63638 solid 1px"),n("#jb-job-meta_"+o).parent().find("p.description").css("color","#d63638")}),r.lockPostSaving("jbwp"),s.createErrorNotice(o.notice,{id:"jbwp-validation",isDismissible:!0}),c=!0)},error:function(o){console.log(o),r.unlockPostSaving("jbwp"),c=!1}}))},i=1e3,a=0,function(){var o=this,e=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(o,e)},i||0)}))}(jQuery);